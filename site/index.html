<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <title>#OffsetTrump</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">

    <!-- Font Awesome -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- Default Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,600,500,700,800,900' rel='stylesheet' type='text/css'>

    <!-- Vitality Theme CSS -->
    <link href="css/vitality-red.css" rel="stylesheet" type="text/css">

    <!-- IE8 support for HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Landing Page Demo Styles -->
    <style>
    .demo-header {
        text-align: center;
        background: url('img/fist.jpg') no-repeat center center scroll;
        color: #fff;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        background-size: cover;
        -o-background-size: cover;
        padding: 100px 0;
    }
    
    .preview-pane {
        text-align: center;
        margin-bottom: 30px;
        padding: 15px;
    }
    
    .preview-pane hr {
        max-width: 50px;
        margin: 5px auto;
    }
    
    .preview-pane a {
        color: #222;
    }
    
    .preview-pane a:focus {
        outline: none;
    }
    
    .preview-pane a img {
        -webkit-transition: all 0.5s;
        -moz-transition: all 0.5s;
        transition: all 0.5s;
    }
    
    .preview-pane a:hover img {
        opacity: 0.5;
    }
    
    .label-primary {
        background-color: #EF4035;
    }
    
    .cta-list {
        margin-top: 30px;
    }
    </style>

    <!-- Landing Page Demo Styles - FLGM overrides -->
    <style>
    .preview-pane {
        border: 1px solid black;
    }

    .pledge-container {
        padding-top: 40px;
    }

    #pledge-input {
        margin-top: 8px;
    }

    .demo-header-content {
        background-color: rgba(2, 2, 2, .5);
    }
    </style>

</head>

<body>

    <div class="demo-header">
        <div class="demo-header-content">
            <div class="container">
                <h1>Offset Trump</h1>
                <hr class="colored">
                <p>Pledge to do something good over the next four years to offset the potential negative effects of the Trump presidency</p>
            </div>
        </div>
    </div>
    <div class="container pledge-container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2 container">
                <form id="new-pledge">
                    <div class="form-group row">
                        <div class="col-sm-6 text-center">
                            <input id="pledge-input" size="36" type="text" name="pledge" placeholder="I will ..."/>
                        </div>
                        <div class="col-sm-4 text-center">
                        <button type="submit" class="btn btn-primary">Submit your pledge</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="container" id="pledges">
    </div>

    <div class="hidden">
        <div id="pane-template" class="col-md-4">
            <div class="preview-pane">
                <h3 data-pledge>I will X</h3>
                <hr class="colored">
                <p data-author class="text-muted">Anonymous</p>
            </div>
        </div>
    </div>

    <!-- Core Scripts -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Plugin Scripts -->
    <script src="vendor/jquery.easing/jquery.easing.min.js"></script>
    <script src="vendor/formstone/core.js"></script>
    <script src="vendor/formstone/transition.js"></script>
    <script src="vendor/formstone/background.js"></script>
    <script src="vendor/mixitup/jquery.mixitup.js"></script>
    <script src="vendor/wow/wow.min.js"></script>

    <!-- Vitality Theme Scripts -->
    <script src="js/vitality.js"></script>

    <script>
    // Smooth Scrolling: Smooth scrolls to an ID on the current page.
    $('a.page-scroll-demo').bind('click', function(event) {
        var $anchor = $(this);
        $('html, body').stop().animate({
            scrollTop: ($($anchor.attr('href')).offset().top)
        }, 1250, 'easeInOutExpo');
        event.preventDefault();
    });
    </script>

    <script>
        var pledgesEndpoint = 'https://px4xnd5ac1.execute-api.us-east-1.amazonaws.com/dev/pledges';
        var pledgesDiv = document.getElementById('pledges');
        var pledgeTemplate = document.getElementById('pane-template');

        function refreshPledges() {
            var row;
            function addPledge(pledgeItem, i) {
                if (i % 3 === 0) {
                    row = document.createElement('div');
                    row.classList.add('row');
                    row.classList.add('content-row');
                    pledgesDiv.appendChild(row);
                }
                var pledge = pledgeTemplate.cloneNode(true);
                pledge.removeAttribute('id');
                pledge.querySelector('[data-pledge]').innerText = pledgeItem.Pledge;
                row.appendChild(pledge);
            }

            fetch(pledgesEndpoint)
                .then(function(response) { return response.json(); })
                .then(function(json) {
                    while (pledgesDiv.firstChild) {
                        pledgesDiv.removeChild(pledgesDiv.firstChild);
                    }
                    json.forEach(addPledge);
                });
        };

        var pledgeForm = document.getElementById('new-pledge');
        var pledgeInput = document.getElementById('pledge-input');
        pledgeForm.onsubmit = function(e) {
            e.preventDefault();
            var formData = new FormData(pledgeForm);

            fetch(pledgesEndpoint, {
                method: 'POST',
                body: formData
            }).then(refreshPledges)
            .then(function() {
                pledgeInput.value = '';
            });
        };
        window.onload = refreshPledges;
    </script>

</body>

</html>
